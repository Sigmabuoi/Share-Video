<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShareTube — Chia sẻ video</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
    <h1 class="text-2xl font-bold text-center text-gray-800 mb-4">ShareTube</h1>
    <p class="text-center text-gray-600 mb-4">Dán link YouTube / Vimeo / MP4. Mở file là chạy — không cần server.</p>

    <!-- Input Form -->
    <div class="mb-4">
      <input id="videoLink" type="text" placeholder="Dán link video..." class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      <button onclick="addVideo()" class="mt-2 w-full bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600">Thêm</button>
    </div>

    <!-- Video List -->
    <div id="videoList" class="mb-4"></div>

    <!-- Video Player -->
    <div id="videoPlayer" class="mb-4 hidden">
      <video id="player" controls class="w-full rounded-lg"></video>
    </div>

    <!-- Share Buttons -->
    <div class="flex space-x-2 mb-4">
      <button onclick="exportLinks()" class="flex-1 bg-green-500 text-white p-2 rounded-lg hover:bg-green-600">Export</button>
      <button onclick="showImportModal()" class="flex-1 bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600">Import</button>
      <button onclick="shareLink()" class="flex-1 bg-indigo-500 text-white p-2 rounded-lg hover:bg-indigo-600">Chia sẻ</button>
    </div>

    <!-- QR Code -->
    <div id="qrCode" class="flex justify-center mb-4 hidden"></div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-sm">
      <h2 class="text-lg font-bold mb-4">Import Links</h2>
      <textarea id="importText" class="w-full p-2 border rounded-lg mb-4" placeholder="Dán danh sách link..."></textarea>
      <div class="flex space-x-2">
        <button onclick="importLinks()" class="flex-1 bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600">Xác nhận</button>
        <button onclick="closeImportModal()" class="flex-1 bg-gray-500 text-white p-2 rounded-lg hover:bg-gray-600">Đóng</button>
      </div>
    </div>
  </div>

  <script>
    let videos = JSON.parse(localStorage.getItem('videos')) || [];

    function addVideo() {
      const link = document.getElementById('videoLink').value.trim();
      if (link) {
        videos.push(link);
        localStorage.setItem('videos', JSON.stringify(videos));
        document.getElementById('videoLink').value = '';
        renderVideoList();
      }
    }

    function renderVideoList() {
      const videoList = document.getElementById('videoList');
      videoList.innerHTML = '';
      videos.forEach((link, index) => {
        const div = document.createElement('div');
        div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-lg mb-2';
        div.innerHTML = `
          <span class="text-gray-700 truncate">${link}</span>
          <div>
            <button onclick="playVideo('${link}')" class="text-blue-500 hover:text-blue-700 mr-2">Phát</button>
            <button onclick="deleteVideo(${index})" class="text-red-500 hover:text-red-700">Xóa</button>
          </div>
        `;
        videoList.appendChild(div);
      });
    }

    function playVideo(link) {
      const player = document.getElementById('player');
      const videoPlayer = document.getElementById('videoPlayer');
      player.src = link;
      videoPlayer.classList.remove('hidden');
      player.play();
    }

    function deleteVideo(index) {
      videos.splice(index, 1);
      localStorage.setItem('videos', JSON.stringify(videos));
      renderVideoList();
    }

    function exportLinks() {
      const exportData = JSON.stringify(videos);
      navigator.clipboard.writeText(exportData).then(() => {
        alert('Đã sao chép danh sách link vào clipboard!');
      });
    }

    function showImportModal() {
      document.getElementById('importModal').classList.remove('hidden');
    }

    function closeImportModal() {
      document.getElementById('importModal').classList.add('hidden');
    }

    function importLinks() {
      const importText = document.getElementById('importText').value.trim();
      try {
        const importedVideos = JSON.parse(importText);
        if (Array.isArray(importedVideos)) {
          videos = importedVideos;
          localStorage.setItem('videos', JSON.stringify(videos));
          renderVideoList();
          closeImportModal();
        } else {
          alert('Dữ liệu import không hợp lệ!');
        }
      } catch (e) {
        alert('Lỗi khi import: ' + e.message);
      }
    }

    function shareLink() {
      const shareData = btoa(JSON.stringify(videos));
      const shareUrl = `${window.location.origin}?videos=${shareData}`;
      document.getElementById('qrCode').innerHTML = '';
      document.getElementById('qrCode').classList.remove('hidden');
      new QRCode(document.getElementById('qrCode'), {
        text: shareUrl,
        width: 128,
        height: 128
      });
      navigator.clipboard.writeText(shareUrl).then(() => {
        alert('Đã sao chép link chia sẻ vào clipboard!');
      });
    }

    // Load videos from URL query if present
    const urlParams = new URLSearchParams(window.location.search);
    const sharedVideos = urlParams.get('videos');
    if (sharedVideos) {
      try {
        videos = JSON.parse(atob(sharedVideos));
        localStorage.setItem('videos', JSON.stringify(videos));
      } catch (e) {
        console.error('Error loading shared videos:', e);
      }
    }

    // Initial render
    renderVideoList();
  </script>
</body>
</html>
